<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ads Management - Nagging Wife AI</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
  <style>
    .sidebar { min-height: 100vh; max-height: 100vh; overflow-y: auto; background: #1e3a5f; position: sticky; top: 0; }
    .sidebar .nav-link { color: rgba(255,255,255,0.8); padding: 0.75rem 1rem; }
    .sidebar .nav-link:hover, .sidebar .nav-link.active { color: #fff; background: rgba(255,255,255,0.1); }
    .sidebar .nav-link i { margin-right: 0.5rem; }
    .main-content { background: #f8f9fa; min-height: 100vh; }
    .nav-divider { border-top: 1px solid rgba(255,255,255,0.2); margin: 0.5rem 0; }
    .nav-section { color: rgba(255,255,255,0.5); font-size: 0.75rem; padding: 0.5rem 1rem; text-transform: uppercase; }
    .bulk-actions { display: none; background: #e3f2fd; padding: 0.75rem 1rem; border-radius: 8px; }
    .bulk-actions.show { display: flex; }
    .row-checkbox { cursor: pointer; }
    tr.selected { background-color: #cfe2ff !important; }
    tr.selected td { background-color: #cfe2ff !important; }
    tbody tr:hover { background-color: #f8f9fa; }
    tbody tr.selected:hover { background-color: #b6d4fe !important; }
    .ad-thumbnail { width: 80px; height: 50px; object-fit: cover; border-radius: 4px; }
    .category-card { transition: transform 0.2s; cursor: pointer; }
    .category-card:hover { transform: translateY(-3px); }
  </style>
</head>
<body>
  <div class="container-fluid">
    <div class="row">
      <%- include('_sidebar', { token, active: 'ads-management' }) %>

      <main class="col-md-10 ms-sm-auto main-content p-4">
        <div class="d-flex justify-content-between align-items-center mb-4">
          <h2><i class="bi bi-megaphone text-primary me-2"></i>Ads Management</h2>
          <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addAdModal">
            <i class="bi bi-plus-lg"></i> Add Ad
          </button>
        </div>

        <!-- Category Cards - Regular Guy Ads -->
        <h5 class="mb-3"><i class="bi bi-person-badge"></i> Regular Guy Ads</h5>
        <div class="row mb-4">
          <div class="col-md-2 mb-3">
            <div class="card category-card h-100" onclick="filterCategory('hunting')">
              <div class="card-body text-center py-3">
                <i class="bi bi-bullseye text-danger" style="font-size: 1.5rem;"></i>
                <p class="mb-0 mt-2 small"><strong>Hunting</strong></p>
              </div>
            </div>
          </div>
          <div class="col-md-2 mb-3">
            <div class="card category-card h-100" onclick="filterCategory('fishing')">
              <div class="card-body text-center py-3">
                <i class="bi bi-water text-info" style="font-size: 1.5rem;"></i>
                <p class="mb-0 mt-2 small"><strong>Fishing</strong></p>
              </div>
            </div>
          </div>
          <div class="col-md-2 mb-3">
            <div class="card category-card h-100" onclick="filterCategory('tools')">
              <div class="card-body text-center py-3">
                <i class="bi bi-tools text-warning" style="font-size: 1.5rem;"></i>
                <p class="mb-0 mt-2 small"><strong>Tools</strong></p>
              </div>
            </div>
          </div>
          <div class="col-md-2 mb-3">
            <div class="card category-card h-100" onclick="filterCategory('survival')">
              <div class="card-body text-center py-3">
                <i class="bi bi-compass text-success" style="font-size: 1.5rem;"></i>
                <p class="mb-0 mt-2 small"><strong>Survival</strong></p>
              </div>
            </div>
          </div>
          <div class="col-md-2 mb-3">
            <div class="card category-card h-100" onclick="filterCategory('diy')">
              <div class="card-body text-center py-3">
                <i class="bi bi-hammer text-secondary" style="font-size: 1.5rem;"></i>
                <p class="mb-0 mt-2 small"><strong>D.I.Y</strong></p>
              </div>
            </div>
          </div>
          <div class="col-md-2 mb-3">
            <div class="card category-card h-100" onclick="filterCategory('cars-trucks')">
              <div class="card-body text-center py-3">
                <i class="bi bi-truck text-primary" style="font-size: 1.5rem;"></i>
                <p class="mb-0 mt-2 small"><strong>Cars/Trucks</strong></p>
              </div>
            </div>
          </div>
        </div>

        <h5 class="mb-3"><i class="bi bi-calendar-heart"></i> Seasonal Ads</h5>
        <div class="row mb-4">
          <div class="col-md-2 mb-3">
            <div class="card category-card h-100 bg-danger text-white" onclick="filterCategory('valentines')">
              <div class="card-body text-center py-3">
                <i class="bi bi-heart-fill" style="font-size: 1.5rem;"></i>
                <p class="mb-0 mt-2 small"><strong>Valentine's</strong></p>
              </div>
            </div>
          </div>
          <div class="col-md-2 mb-3">
            <div class="card category-card h-100 bg-success text-white" onclick="filterCategory('christmas')">
              <div class="card-body text-center py-3">
                <i class="bi bi-tree-fill" style="font-size: 1.5rem;"></i>
                <p class="mb-0 mt-2 small"><strong>Christmas</strong></p>
              </div>
            </div>
          </div>
          <div class="col-md-2 mb-3">
            <div class="card category-card h-100" style="background: #e91e63; color: white;" onclick="filterCategory('mothers-day')">
              <div class="card-body text-center py-3">
                <i class="bi bi-flower1" style="font-size: 1.5rem;"></i>
                <p class="mb-0 mt-2 small"><strong>Mother's Day</strong></p>
              </div>
            </div>
          </div>
          <div class="col-md-2 mb-3">
            <div class="card category-card h-100 bg-primary text-white" onclick="filterCategory('birthday')">
              <div class="card-body text-center py-3">
                <i class="bi bi-cake" style="font-size: 1.5rem;"></i>
                <p class="mb-0 mt-2 small"><strong>Birthday</strong></p>
              </div>
            </div>
          </div>
          <div class="col-md-2 mb-3">
            <div class="card category-card h-100 bg-warning text-dark" onclick="filterCategory('anniversary')">
              <div class="card-body text-center py-3">
                <i class="bi bi-heart" style="font-size: 1.5rem;"></i>
                <p class="mb-0 mt-2 small"><strong>Anniversary</strong></p>
              </div>
            </div>
          </div>
          <div class="col-md-2 mb-3">
            <div class="card category-card h-100" onclick="filterCategory('all')">
              <div class="card-body text-center py-3">
                <i class="bi bi-grid" style="font-size: 1.5rem;"></i>
                <p class="mb-0 mt-2 small"><strong>View All</strong></p>
              </div>
            </div>
          </div>
        </div>

        <!-- Stats Cards -->
        <div class="row mb-4">
          <div class="col-md-3">
            <div class="card bg-success text-white">
              <div class="card-body">
                <h6><i class="bi bi-check-circle"></i> Active Ads</h6>
                <h3 class="mb-0"><%= activeCount || 0 %></h3>
              </div>
            </div>
          </div>
          <div class="col-md-3">
            <div class="card bg-info text-white">
              <div class="card-body">
                <h6><i class="bi bi-eye"></i> Total Impressions</h6>
                <h3 class="mb-0"><%= (totalImpressions || 0).toLocaleString() %></h3>
              </div>
            </div>
          </div>
          <div class="col-md-3">
            <div class="card bg-primary text-white">
              <div class="card-body">
                <h6><i class="bi bi-hand-index"></i> Total Clicks</h6>
                <h3 class="mb-0"><%= (totalClicks || 0).toLocaleString() %></h3>
              </div>
            </div>
          </div>
          <div class="col-md-3">
            <div class="card bg-warning text-dark">
              <div class="card-body">
                <h6><i class="bi bi-percent"></i> Avg CTR</h6>
                <h3 class="mb-0"><%= avgCtr || '0.0' %>%</h3>
              </div>
            </div>
          </div>
        </div>

        <!-- Bulk Actions -->
        <div class="bulk-actions mb-3" id="bulkActions">
          <span class="me-3"><strong id="selectedCount">0</strong> selected</span>
          <button class="btn btn-sm btn-outline-success me-2" onclick="enableSelected()" data-bs-toggle="tooltip" title="Enable selected ads">
            <i class="bi bi-check-circle"></i> Enable
          </button>
          <button class="btn btn-sm btn-outline-secondary me-2" onclick="disableSelected()" data-bs-toggle="tooltip" title="Disable selected ads">
            <i class="bi bi-x-circle"></i> Disable
          </button>
          <button class="btn btn-sm btn-outline-danger" onclick="deleteSelected()" data-bs-toggle="tooltip" title="Delete selected ads">
            <i class="bi bi-trash"></i> Delete
          </button>
        </div>

        <div class="card">
          <div class="card-body p-0">
            <table class="table table-hover mb-0">
              <thead class="table-light">
                <tr>
                  <th style="width: 40px;">
                    <input type="checkbox" class="form-check-input" id="selectAll" data-bs-toggle="tooltip" title="Select all">
                  </th>
                  <th>Preview</th>
                  <th>Ad Title</th>
                  <th>Category</th>
                  <th>Placement</th>
                  <th>Impressions</th>
                  <th>Clicks</th>
                  <th>Status</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="tableBody">
                <% if (ads && ads.length > 0) { %>
                  <% ads.forEach(ad => { %>
                  <tr>
                    <td><input type="checkbox" class="form-check-input row-checkbox" data-id="<%= ad.id %>"></td>
                    <td>
                      <% if (ad.imageUrl) { %>
                        <img src="<%= ad.imageUrl %>" alt="<%= ad.title %>" class="ad-thumbnail">
                      <% } else { %>
                        <div class="ad-thumbnail bg-light d-flex align-items-center justify-content-center">
                          <i class="bi bi-image text-muted"></i>
                        </div>
                      <% } %>
                    </td>
                    <td>
                      <strong><%= ad.title %></strong>
                      <% if (ad.advertiser) { %>
                        <br><small class="text-muted">by <%= ad.advertiser %></small>
                      <% } %>
                    </td>
                    <td>
                      <span class="badge bg-secondary"><%= ad.category.replace('-', '/').replace(/\b\w/g, l => l.toUpperCase()) %></span>
                    </td>
                    <td>
                      <span class="badge bg-<%= ad.placement === 'hero' ? 'primary' : ad.placement === 'banner' ? 'info' : ad.placement === 'announcement-bar' ? 'warning text-dark' : 'secondary' %>">
                        <%= ad.placement.replace('-', ' ').replace(/\b\w/g, l => l.toUpperCase()) %>
                      </span>
                    </td>
                    <td><%= (ad.impressions || 0).toLocaleString() %></td>
                    <td><%= (ad.clickCount || 0).toLocaleString() %></td>
                    <td>
                      <% if (ad.isActive) { %>
                        <span class="badge bg-success"><i class="bi bi-check"></i> Active</span>
                      <% } else { %>
                        <span class="badge bg-secondary"><i class="bi bi-x"></i> Inactive</span>
                      <% } %>
                    </td>
                    <td>
                      <button class="btn btn-sm btn-outline-primary" onclick="editAd('<%= ad.id %>')" data-bs-toggle="tooltip" title="Edit ad">
                        <i class="bi bi-pencil"></i>
                      </button>
                      <button class="btn btn-sm btn-outline-info" onclick="previewAd('<%= ad.id %>')" data-bs-toggle="tooltip" title="Preview ad">
                        <i class="bi bi-eye"></i>
                      </button>
                      <button class="btn btn-sm btn-outline-danger" onclick="deleteAd('<%= ad.id %>')" data-bs-toggle="tooltip" title="Delete ad">
                        <i class="bi bi-trash"></i>
                      </button>
                    </td>
                  </tr>
                  <% }) %>
                <% } else { %>
                <tr>
                  <td colspan="9" class="text-center py-5">
                    <i class="bi bi-megaphone text-muted" style="font-size: 3rem;"></i>
                    <h5 class="mt-3">No Ads Yet</h5>
                    <p class="text-muted">Create ads for hunting, fishing, tools, and seasonal promotions!</p>
                    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addAdModal">
                      <i class="bi bi-plus-lg"></i> Create First Ad
                    </button>
                  </td>
                </tr>
                <% } %>
              </tbody>
            </table>
          </div>
          <div class="card-footer bg-white d-flex justify-content-between align-items-center">
            <div class="text-muted small">Showing <span id="showingStart">1</span>-<span id="showingEnd"><%= ads?.length || 0 %></span> of <span id="totalRows"><%= ads?.length || 0 %></span></div>
            <nav>
              <ul class="pagination pagination-sm mb-0" id="pagination"></ul>
            </nav>
            <select class="form-select form-select-sm" id="pageSize" style="width: auto;">
              <option value="10">10 / page</option>
              <option value="25">25 / page</option>
              <option value="50">50 / page</option>
            </select>
          </div>
        </div>
      </main>
    </div>
  </div>

  <!-- Edit Ad Modal -->
  <div class="modal fade" id="editAdModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title"><i class="bi bi-pencil me-2"></i>Edit Ad</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <form id="editAdForm">
          <input type="hidden" name="id" id="editAdId">
          <div class="modal-body">
            <div class="row">
              <div class="col-md-8 mb-3">
                <label class="form-label">Ad Title <span class="text-danger">*</span></label>
                <input type="text" class="form-control" name="title" id="editTitle" required>
              </div>
              <div class="col-md-4 mb-3">
                <label class="form-label">Advertiser</label>
                <input type="text" class="form-control" name="advertiser" id="editAdvertiser">
              </div>
            </div>
            <div class="row">
              <div class="col-md-6 mb-3">
                <label class="form-label">Category <span class="text-danger">*</span></label>
                <select class="form-select" name="category" id="editCategory" required>
                  <optgroup label="Regular Guy Ads">
                    <option value="hunting">Hunting</option>
                    <option value="fishing">Fishing</option>
                    <option value="tools">Tools</option>
                    <option value="survival">Survival</option>
                    <option value="diy">D.I.Y</option>
                    <option value="cars-trucks">Cars & Trucks</option>
                    <option value="sports">Sports</option>
                  </optgroup>
                  <optgroup label="Seasonal Ads">
                    <option value="christmas">Christmas</option>
                    <option value="valentines">Valentine's Day</option>
                    <option value="mothers-day">Mother's Day</option>
                    <option value="birthday">Birthday</option>
                    <option value="anniversary">Anniversary</option>
                    <option value="seasonal">Seasonal</option>
                  </optgroup>
                </select>
              </div>
              <div class="col-md-6 mb-3">
                <label class="form-label">Placement <span class="text-danger">*</span></label>
                <select class="form-select" name="placement" id="editPlacement" required>
                  <option value="sidebar">Sidebar</option>
                  <option value="banner">Banner</option>
                  <option value="announcement-bar">Announcement Bar</option>
                  <option value="hero">Hero Section</option>
                </select>
              </div>
            </div>
            <div class="mb-3">
              <label class="form-label">Description</label>
              <textarea class="form-control" name="description" id="editDescription" rows="2"></textarea>
            </div>
            <div class="row">
              <div class="col-md-6 mb-3">
                <label class="form-label">Image URL</label>
                <input type="url" class="form-control" name="imageUrl" id="editImageUrl">
              </div>
              <div class="col-md-6 mb-3">
                <label class="form-label">Link URL</label>
                <input type="url" class="form-control" name="linkUrl" id="editLinkUrl">
              </div>
            </div>
            <div class="row">
              <div class="col-md-4 mb-3">
                <label class="form-label">Start Date</label>
                <input type="date" class="form-control" name="startDate" id="editStartDate">
              </div>
              <div class="col-md-4 mb-3">
                <label class="form-label">End Date</label>
                <input type="date" class="form-control" name="endDate" id="editEndDate">
              </div>
              <div class="col-md-4 mb-3">
                <label class="form-label">Priority</label>
                <input type="number" class="form-control" name="priority" id="editPriority" min="0" max="100">
              </div>
            </div>
            <div class="form-check">
              <input class="form-check-input" type="checkbox" name="isActive" id="editIsActive">
              <label class="form-check-label" for="editIsActive">
                Active (will be displayed)
              </label>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <button type="submit" class="btn btn-primary"><i class="bi bi-check-lg"></i> Update Ad</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Add Ad Modal -->
  <div class="modal fade" id="addAdModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title"><i class="bi bi-megaphone me-2"></i>Add New Ad</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <form id="addAdForm">
          <div class="modal-body">
            <div class="row">
              <div class="col-md-8 mb-3">
                <label class="form-label">Ad Title <span class="text-danger">*</span></label>
                <input type="text" class="form-control" name="title" placeholder="e.g., Best Hunting Gear 2024" required>
              </div>
              <div class="col-md-4 mb-3">
                <label class="form-label">Advertiser</label>
                <input type="text" class="form-control" name="advertiser" placeholder="e.g., Bass Pro Shop">
              </div>
            </div>
            <div class="row">
              <div class="col-md-6 mb-3">
                <label class="form-label">Category <span class="text-danger">*</span></label>
                <select class="form-select" name="category" required>
                  <optgroup label="Regular Guy Ads">
                    <option value="hunting">Hunting</option>
                    <option value="fishing">Fishing</option>
                    <option value="tools">Tools</option>
                    <option value="survival">Survival</option>
                    <option value="diy">D.I.Y</option>
                    <option value="cars-trucks">Cars & Trucks</option>
                    <option value="sports">Sports</option>
                  </optgroup>
                  <optgroup label="Seasonal Ads">
                    <option value="christmas">Christmas</option>
                    <option value="valentines">Valentine's Day</option>
                    <option value="mothers-day">Mother's Day</option>
                    <option value="birthday">Birthday</option>
                    <option value="anniversary">Anniversary</option>
                  </optgroup>
                </select>
              </div>
              <div class="col-md-6 mb-3">
                <label class="form-label">Placement <span class="text-danger">*</span></label>
                <select class="form-select" name="placement" required>
                  <option value="sidebar">Sidebar</option>
                  <option value="banner">Banner</option>
                  <option value="announcement-bar">Announcement Bar</option>
                  <option value="hero">Hero Section</option>
                </select>
              </div>
            </div>
            <div class="mb-3">
              <label class="form-label">Description</label>
              <textarea class="form-control" name="description" rows="2" placeholder="Ad description..."></textarea>
            </div>
            <div class="row">
              <div class="col-md-6 mb-3">
                <label class="form-label">Image URL</label>
                <input type="url" class="form-control" name="imageUrl" placeholder="https://...">
              </div>
              <div class="col-md-6 mb-3">
                <label class="form-label">Link URL</label>
                <input type="url" class="form-control" name="linkUrl" placeholder="https://...">
              </div>
            </div>
            <div class="row">
              <div class="col-md-4 mb-3">
                <label class="form-label">Start Date</label>
                <input type="date" class="form-control" name="startDate">
              </div>
              <div class="col-md-4 mb-3">
                <label class="form-label">End Date</label>
                <input type="date" class="form-control" name="endDate">
              </div>
              <div class="col-md-4 mb-3">
                <label class="form-label">Priority</label>
                <input type="number" class="form-control" name="priority" value="0" min="0" max="100">
              </div>
            </div>
            <div class="form-check">
              <input class="form-check-input" type="checkbox" name="isActive" id="isActiveCheck" checked>
              <label class="form-check-label" for="isActiveCheck">
                Active (will be displayed)
              </label>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <button type="submit" class="btn btn-primary"><i class="bi bi-check-lg"></i> Save Ad</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <%- include('_table-controls') %>
  <script>
    const token = '<%= token %>';
    let tableControls;

    document.addEventListener('DOMContentLoaded', () => {
      // Initialize table controls with pagination and selection
      tableControls = new TableControls();

      document.getElementById('addAdForm')?.addEventListener('submit', async (e) => {
        e.preventDefault();
        const formData = new FormData(e.target);
        const data = Object.fromEntries(formData);
        data.isActive = document.getElementById('isActiveCheck').checked;

        try {
          const res = await fetch(`/admin/ads-management?token=${token}`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
          });
          if (res.ok) {
            location.reload();
          } else {
            alert('Failed to save ad');
          }
        } catch (err) {
          alert('Error: ' + err.message);
        }
      });

      document.getElementById('editAdForm')?.addEventListener('submit', async (e) => {
        e.preventDefault();
        const id = document.getElementById('editAdId').value;
        const data = {
          title: document.getElementById('editTitle').value,
          advertiser: document.getElementById('editAdvertiser').value || null,
          category: document.getElementById('editCategory').value,
          placement: document.getElementById('editPlacement').value,
          description: document.getElementById('editDescription').value || null,
          imageUrl: document.getElementById('editImageUrl').value || null,
          linkUrl: document.getElementById('editLinkUrl').value || null,
          startDate: document.getElementById('editStartDate').value || null,
          endDate: document.getElementById('editEndDate').value || null,
          priority: parseInt(document.getElementById('editPriority').value) || 0,
          isActive: document.getElementById('editIsActive').checked
        };

        try {
          const res = await fetch(`/admin/ads-management/${id}?token=${token}`, {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
          });
          if (res.ok) {
            location.reload();
          } else {
            alert('Failed to update ad');
          }
        } catch (err) {
          alert('Error: ' + err.message);
        }
      });
    });

    function getSelectedIds() {
      return Array.from(document.querySelectorAll('.row-checkbox:checked')).map(cb => cb.dataset.id);
    }

    function filterCategory(category) {
      window.location.href = `/admin/ads-management?token=${token}&category=${category}`;
    }

    async function enableSelected() {
      const ids = getSelectedIds();
      if (ids.length === 0) return;

      try {
        const res = await fetch(`/admin/ads-management/bulk-enable?token=${token}`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ ids })
        });
        if (res.ok) location.reload();
      } catch (err) {
        alert('Error: ' + err.message);
      }
    }

    async function disableSelected() {
      const ids = getSelectedIds();
      if (ids.length === 0) return;

      try {
        const res = await fetch(`/admin/ads-management/bulk-disable?token=${token}`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ ids })
        });
        if (res.ok) location.reload();
      } catch (err) {
        alert('Error: ' + err.message);
      }
    }

    async function deleteSelected() {
      const ids = getSelectedIds();
      if (ids.length === 0) return;
      if (!confirm(`Delete ${ids.length} ad(s)?`)) return;

      try {
        const res = await fetch(`/admin/ads-management/bulk-delete?token=${token}`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ ids })
        });
        if (res.ok) location.reload();
      } catch (err) {
        alert('Error: ' + err.message);
      }
    }

    async function deleteAd(id) {
      if (!confirm('Delete this ad?')) return;
      try {
        const res = await fetch(`/admin/ads-management/${id}?token=${token}`, { method: 'DELETE' });
        if (res.ok) location.reload();
      } catch (err) {
        alert('Error: ' + err.message);
      }
    }

    async function editAd(id) {
      try {
        const res = await fetch(`/admin/ads-management/${id}/edit?token=${token}`);
        const data = await res.json();
        if (data.success && data.ad) {
          const ad = data.ad;
          document.getElementById('editAdId').value = ad.id;
          document.getElementById('editTitle').value = ad.title || '';
          document.getElementById('editAdvertiser').value = ad.advertiser || '';
          document.getElementById('editCategory').value = ad.category || 'hunting';
          document.getElementById('editPlacement').value = ad.placement || 'sidebar';
          document.getElementById('editDescription').value = ad.description || '';
          document.getElementById('editImageUrl').value = ad.imageUrl || '';
          document.getElementById('editLinkUrl').value = ad.linkUrl || '';
          document.getElementById('editStartDate').value = ad.startDate ? ad.startDate.substring(0, 10) : '';
          document.getElementById('editEndDate').value = ad.endDate ? ad.endDate.substring(0, 10) : '';
          document.getElementById('editPriority').value = ad.priority || 0;
          document.getElementById('editIsActive').checked = ad.isActive;
          new bootstrap.Modal(document.getElementById('editAdModal')).show();
        } else {
          alert('Failed to load ad');
        }
      } catch (err) {
        alert('Error: ' + err.message);
      }
    }

    function previewAd(id) {
      window.open(`/admin/ads-management/${id}/preview?token=${token}`, '_blank', 'width=600,height=400');
    }
  </script>
</body>
</html>
